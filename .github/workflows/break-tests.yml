name: break-tests

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  phase1:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install deps
        run: pip install pytest
      - name: Run Phase 1 golden path
        run: pytest -q model-layer/tests/break/test_phase1_golden.py -q

  phase3-smoke:
    runs-on: ubuntu-latest
    needs: phase1
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install deps
        run: pip install pytest
      - name: Run Phase 3 smoke stress runner
        run: python tools/breaker/stress_runner.py --runs 50 --workers 4 --seed 0 --smoke
